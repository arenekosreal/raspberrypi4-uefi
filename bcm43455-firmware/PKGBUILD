# Maintainer: zhanghua <zhanghua.00@qq.com>

buildarch=1 # any

pkgname=bcm43455-firmware
pkgver=20220212
pkgrel=1
pkgdesc="Bluetooth and WLAN firmware of BCM43455 for Raspberry Pi 4B"
url=https://git.kernel.org/cgit/linux/kernel/git/firmware/linux-firmware.git
arch=("any")
license=("GPL2")
makedepends=("git")
conflicts=("firmware-raspberrypi")
provides=("brcmfmac43455-firmware")
source=(
    git+https://github.com/RPi-Distro/firmware-nonfree
    git+https://github.com/RPi-Distro/bluez-firmware
    )
sha256sums=('SKIP'
            'SKIP')
options=("!strip")

pkgver(){
    date -uI | sed "s/-//g"
}
package(){
    for file in brcmfmac43455-sdio.bin brcmfmac43455-sdio.clm_blob brcmfmac43455-sdio.txt brcmfmac43455-sdio.raspberrypi,4-model-b.txt
    do
        install -Dm644 ${srcdir}/firmware-nonfree/debian/config/brcm80211/brcm/${file} ${pkgdir}/usr/lib/firmware/updates/brcm/${file}
    done
    install -Dm644 ${srcdir}/bluez-firmware/broadcom/BCM4345C0.hcd ${pkgdir}/usr/lib/firmware/updates/brcm/BCM4345C0.hcd
    ln -s brcmfmac43455-sdio.raspberrypi,4-model-b.txt "${pkgdir}/usr/lib/firmware/updates/brcm/brcmfmac43455-sdio.Raspberry Pi Foundation-Raspberry Pi 4 Model B.txt"
    ln -s brcmfmac43455-sdio.bin "${pkgdir}/usr/lib/firmware/updates/brcm/brcmfmac43455-sdio.Raspberry Pi Foundation-Raspberry Pi 4 Model B.bin"
    install -Dm644 ${srcdir}/firmware-nonfree/debian/copyright.debian ${pkgdir}/usr/share/licenses/${pkgname}/LICENCE
}
